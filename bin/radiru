#!/usr/bin/env ruby

require "rbradi"
include Rbradi

require "optparse"

channel = nil
filename = nil
min = 30
quiet = false
wait = 0

stations = Radiru::channels.keys
opt = OptionParser.new
opt.version = Rbradi::VERSION
opt.on("-c channel_name","--channel", stations*'|'){|v| channel = v}
opt.on("-t [30]","--time", Float, "録音時間 (分）"){|v| min = v}
opt.on("-o ファイル名","--output","出力ファイル"){|v| filename = v}
opt.on("-w [0]", "--wait", Float, "録音開始までの待ち時間（秒）")
opt.on("-q", "--quiet", "録音時の同時再生を行わない" ) {|v| quiet = true}
opt.parse! ARGV

sec = min.to_f*60

radio = Radiru.new
begin
  radio.open
  radio.tune channel
  radio.play wait: wait, sec: sec, filename: filename, quiet: quiet
ensure
  radio.close
end
