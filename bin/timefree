#!/usr/bin/env ruby

require "pry"
require "rbradi"
require "pp"

area_id = ARGV[0] || 'JP8'

account = "fusuian@gmail.com"
password =  "raradiko"

class TimeFree < RadikoPremium
	def play(opts={})
		ch= 'CBC'
		from="20170716080000"
		to=  "20170716090000"
		@stream_uri=%Q(https://radiko.jp/v2/api/ts/playlist.m3u8?l=15&station_id=#{ch}&ft=#{from}&to=#{to})
		radio_play opts
	end

	def make_tmpfile(channel, datetime, outdir = @outdir)
		File.join outdir, "#{channel}.#{datetime}.#{ext}"
	end

	def convert(a,b)
	end

	def create_player(channel)
		ffmpeg = FFMpeg.new
		ffmpeg.merge! 'loglevel' => 'fatal', 'n' => ''
		ffmpeg.merge! 'headers' => %Q("X-Radiko-AuthToken: #{@authtoken}")
		ffmpeg.merge! 'i' => %Q("#{@stream_uri}")
		ffmpeg.merge! 'vn' => ''
	end
end

radio=TimeFree.new 
radio.login account, password 
radio.open
radio.tune 'cbc'
radio.play filename: 'test'
radio.close